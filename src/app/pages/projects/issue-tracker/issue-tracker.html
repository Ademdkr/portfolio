<div class="project-detail">
  <!-- Back Button -->
  <div class="back-nav">
    <a mat-button routerLink="/projects">
      <mat-icon>arrow_back</mat-icon>
      Zurück zu Projekten
    </a>
  </div>

  <!-- 1. Project Header -->
  <section class="project-header">
    <h1>{{ project.title }}</h1>
    <p class="short-description">{{ project.shortDescription }}</p>

    <!-- Tech Stack Badges -->
    <div class="tech-stack">
      <mat-chip-set>
        @for (tech of project.techStack; track tech) {
        <mat-chip>{{ tech }}</mat-chip>
        }
      </mat-chip-set>
    </div>

    <!-- Action Buttons -->
    <div class="action-buttons">
      <a
        mat-raised-button
        color="primary"
        [href]="project.links.demo"
        target="_blank"
        rel="noopener noreferrer"
      >
        <mat-icon>open_in_new</mat-icon>
        Live Demo
      </a>
      <a
        mat-stroked-button
        [href]="project.links.repository"
        target="_blank"
        rel="noopener noreferrer"
      >
        <mat-icon>code</mat-icon>
        Repository
      </a>
    </div>
  </section>

  <mat-divider></mat-divider>

  <!-- 2. Learning Focus -->
  <section class="section">
    <h2>
      <mat-icon>school</mat-icon>
      Lernfokus & Kompetenzen
    </h2>
    <div class="learning-focus-grid">
      @for (focus of learningFocus; track focus.title) {
      <mat-card class="focus-card">
        <mat-card-content>
          <mat-icon color="primary">{{ focus.icon }}</mat-icon>
          <h3>{{ focus.title }}</h3>
          <p>{{ focus.description }}</p>
        </mat-card-content>
      </mat-card>
      }
    </div>
  </section>

  <!-- 3. Features -->
  <section class="section">
    <h2>
      <mat-icon>extension</mat-icon>
      Features
    </h2>
    <div class="features-grid">
      @for (feature of features; track feature.text) {
      <mat-card class="feature-card">
        <mat-card-content>
          <mat-icon color="primary">{{ feature.icon }}</mat-icon>
          <p>{{ feature.text }}</p>
        </mat-card-content>
      </mat-card>
      }
    </div>
  </section>

  <!-- 4. Architecture -->
  <section class="section">
    <h2>
      <mat-icon>account_tree</mat-icon>
      Architektur
    </h2>
    <div class="architecture-grid">
      <mat-card>
        <mat-card-header>
          <mat-card-title>{{ architecture.frontend.title }}</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <ul>
            @for (item of architecture.frontend.items; track item) {
            <li>{{ item }}</li>
            }
          </ul>
        </mat-card-content>
      </mat-card>

      <mat-card>
        <mat-card-header>
          <mat-card-title>{{ architecture.backend.title }}</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <ul>
            @for (item of architecture.backend.items; track item) {
            <li>{{ item }}</li>
            }
          </ul>
        </mat-card-content>
      </mat-card>

      <mat-card>
        <mat-card-header>
          <mat-card-title>{{ architecture.database.title }}</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <ul>
            @for (item of architecture.database.items; track item) {
            <li>{{ item }}</li>
            }
          </ul>
        </mat-card-content>
      </mat-card>

      <mat-card>
        <mat-card-header>
          <mat-card-title>{{ architecture.communication.title }}</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <ul>
            @for (item of architecture.communication.items; track item) {
            <li>{{ item }}</li>
            }
          </ul>
        </mat-card-content>
      </mat-card>
    </div>
  </section>

  <!-- 5. Screenshots & UI-Flows -->
  <section class="section">
    <h2>
      <mat-icon>image</mat-icon>
      Screenshots & UI-Flows
    </h2>
    <div class="screenshots-grid">
      @for (screenshot of screenshots; track screenshot.label) {
      <div class="screenshot-item" (click)="openScreenshot(screenshot)">
        <img
          [src]="'/assets/projects/issue-tracker/screenshots/' + screenshot.image"
          [alt]="screenshot.label"
        />
        <div class="screenshot-overlay">
          <mat-icon>zoom_in</mat-icon>
          <span>{{ screenshot.label }}</span>
        </div>
      </div>
      }
    </div>

    <!-- Lightbox Modal -->
    @if (selectedScreenshot) {
    <div class="lightbox-overlay" (click)="closeScreenshot()">
      <div class="lightbox-content" (click)="$event.stopPropagation()">
        <button mat-icon-button class="close-button" (click)="closeScreenshot()">
          <mat-icon>close</mat-icon>
        </button>
        <img
          [src]="'/assets/projects/issue-tracker/screenshots/' + selectedScreenshot.image"
          [alt]="selectedScreenshot.label"
        />
        <div class="lightbox-info">
          <h3>{{ selectedScreenshot.label }}</h3>
          <p>{{ selectedScreenshot.description }}</p>
        </div>
      </div>
    </div>
    }
  </section>

  <!-- 6. Technical Details -->
  <section class="section">
    <h2>
      <mat-icon>code</mat-icon>
      Technische Details
    </h2>
    <div class="technical-details">
      @for (detail of technicalDetails; track detail.title) {
      <mat-card class="collapsible-card">
        <mat-card-header (click)="toggleSection(detail.title)" class="clickable-header">
          <mat-card-title>
            <span>{{ detail.title }}</span>
            <mat-icon class="expand-icon" [class.expanded]="isSectionExpanded(detail.title)">
              expand_more
            </mat-icon>
          </mat-card-title>
        </mat-card-header>
        @if (isSectionExpanded(detail.title)) {
        <mat-card-content class="collapsible-content">
          @if (detail.imagePath) {
          <div class="architecture-diagram">
            <img [src]="detail.imagePath" [alt]="detail.title" />
          </div>
          } @if (detail.description) {
          <p>{{ detail.description }}</p>
          } @if (detail.items) {
          <ul class="detail-list">
            @for (item of detail.items; track item.label) {
            <li>
              <strong>{{ item.label }}:</strong> {{ item.description }}
              @if (item.code && !item.code.endsWith('.png')) {
              <pre class="code-example"><code>{{ item.code }}</code></pre>
              } @if (item.code && item.code.endsWith('.png')) {
              <div class="screenshot">
                <img
                  [src]="'/assets/projects/issue-tracker/screenshots/' + item.code"
                  [alt]="item.label"
                />
              </div>
              }
            </li>
            }
          </ul>
          }
        </mat-card-content>
        }
      </mat-card>
      }
    </div>
  </section>

  <!-- 7. Challenges & Learnings -->
  <section class="section">
    <h2>
      <mat-icon>psychology</mat-icon>
      Herausforderungen & Learnings
    </h2>

    <!-- Challenges -->
    <h3>Herausforderungen</h3>
    <div class="challenges">
      @for (challenge of challenges; track challenge.title) {
      <mat-card class="challenge-card">
        <mat-card-content>
          <h4>{{ challenge.title }}</h4>
          <p class="problem"><strong>Problem:</strong> {{ challenge.problem }}</p>
          <p class="solution"><strong>Lösung:</strong> {{ challenge.solution }}</p>
        </mat-card-content>
      </mat-card>
      }
    </div>

    <!-- Learnings -->
    <h3>Learnings</h3>
    <mat-card>
      <mat-card-content>
        <ul class="learnings-list">
          @for (learning of learnings; track learning) {
          <li>{{ learning }}</li>
          }
        </ul>
      </mat-card-content>
    </mat-card>
  </section>

  <!-- 8. Mögliche Verbesserungen -->
  <section class="section">
    <h2>
      <mat-icon>lightbulb</mat-icon>
      Mögliche Verbesserungen
    </h2>
    <mat-card>
      <mat-card-content>
        <ul class="improvements-list">
          @for (improvement of improvements; track improvement) {
          <li>{{ improvement }}</li>
          }
        </ul>
      </mat-card-content>
    </mat-card>
  </section>
</div>
